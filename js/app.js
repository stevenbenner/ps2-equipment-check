function Qualifications(a,b){function c(a,b,c,d){var e={};return e.name=a,b&&(e.child=$.isArray(b)?b:[b]),c&&(e.cert=c),d&&(e.isRank=!0),e}function d(a,b){b&&(a.parent?a.parent.push(b):a.parent=[b]),a.child&&$.each(a.child,function(){d(this,a)})}var e={soldier:{meta:{passPercentage:100},classes:{"Heavy Assault":{certifications:[{skill:a.heavyAssault.flakArmor,level:3}],equipment:[]},"Light Assault":{certifications:[{skill:a.lightAssault.flakArmor,level:3}],equipment:[]},Engineer:{certifications:[{skill:a.engineer.flakArmor,level:3},{skill:a.engineer.nanoArmorKit,level:4},{skill:a.engineer.tankMine,level:1}],equipment:[]},Medic:{certifications:[{skill:a.medic.flakArmor,level:3},{skill:a.medic.medicalApplicator,level:4}],equipment:[]},Infiltrator:{certifications:[{skill:a.infiltrator.flakArmor,level:3}],equipment:[]},Sunderer:{certifications:[{skill:a.sunderer.advancedMobileStation,level:1}],equipment:[]},"Squad Leader":{certifications:[{skill:a.squadLeader.priorityDeployment,level:0}],equipment:[]}}},veteran:{meta:{passPercentage:100},classes:{"Heavy Assault":{certifications:[{skill:a.heavyAssault.resistShield,level:1},{skill:a.heavyAssault.antiVehicleGrenade,level:1},{skill:a.universal.medicalKit,level:1}],equipment:[]},"Light Assault":{certifications:[{skill:a.lightAssault.c4,level:2},{skill:a.lightAssault.drifterJumpJets,level:2}],equipment:[]},Engineer:{certifications:[{skill:a.engineer.nanoArmorKit,level:6},{skill:a.engineer.claymoreMine,level:2},{skill:a.engineer.tankMine,level:2},{skill:a.engineer.ammunitionPackage,level:3},{skill:a.engineer.stickyGrenade,level:1}],equipment:[b.weapon.trac5s,b.engineer.avManaTurret]},Medic:{certifications:[{skill:a.medic.medicalApplicator,level:6},{skill:a.medic.nanoRegenDevice,level:6}],equipment:[]},Infiltrator:{certifications:[{skill:a.infiltrator.advancedEquipmentTerminalHacking,level:3}],equipment:[]},Sunderer:{certifications:[{skill:a.sunderer.vehicleAmmoDispenser,level:1},{skill:a.sunderer.blockadeArmor,level:3},{skill:a.sunderer.gateShieldDiffuser,level:2}],equipment:[]},"Squad Leader":{certifications:[{skill:a.squadLeader.priorityDeployment,level:2}],equipment:[]}}},medic:{meta:{passPercentage:100},classes:{"Loadout: Offensive Medic":{certifications:[{skill:a.medic.grenadeBandolier,level:2},{skill:a.medic.naniteReviveGrenade,level:1},{skill:a.medic.nanoRegenDevice,level:6},{skill:a.universal.medicalKit,level:3}],equipment:[]},"Loadout: Defensive Medic":{certifications:[{skill:a.medic.flakArmor,level:4},{skill:a.medic.naniteReviveGrenade,level:1},{skill:a.medic.regenerationField,level:5},{skill:a.universal.medicalKit,level:3}],equipment:[]}}},engineer:{meta:{passPercentage:100},classes:{"Loadout: Anti-Infantry MANA Turret":{certifications:[{skill:a.engineer.flakArmor,level:4},{skill:a.engineer.claymoreMine,level:2}],equipment:[b.weapon.trac5s]},"Loadout: Anti-Vehicle MANA Turret":{certifications:[{skill:a.engineer.flakArmor,level:4},{skill:a.engineer.tankMine,level:2},{skill:a.engineer.avManaTurret,level:1}],equipment:[b.weapon.trac5s,b.engineer.avManaTurret]}}},lightAssault:{meta:{passPercentage:100},classes:{"Loadout: Bounty Hunter":{certifications:[{skill:a.lightAssault.flakArmor,level:4},{skill:a.lightAssault.jumpJets,level:6},{skill:a.lightAssault.flashGrenade,level:1}],equipment:[]},"Loadout: Death From Above":{certifications:[{skill:a.lightAssault.grenadeBandolier,level:2},{skill:a.lightAssault.drifterJumpJets,level:5},{skill:a.lightAssault.smokeGrenade,level:1}],equipment:[]}}},infiltrator:{meta:{passPercentage:100},classes:{"Loadout: Close Quarters":{certifications:[{skill:a.infiltrator.flakArmor,level:4},{skill:a.infiltrator.grenadeBandolier,level:2},{skill:a.infiltrator.reconDetectDevice,level:6},{skill:a.infiltrator.claymoreMine,level:2},{skill:a.infiltrator.empGrenade,level:1}],equipment:[b.weapon.ns7pdw]},"Loadout: Assassin":{certifications:[{skill:a.infiltrator.ammunitionBelt,level:3},{skill:a.infiltrator.motionSpotter,level:5},{skill:a.infiltrator.claymoreMine,level:2},{skill:a.infiltrator.decoyGrenade,level:1},{skill:a.universal.medicalKit,level:3}],equipment:[b.weapon.rams]}}},heavyAssault:{meta:{passPercentage:100},classes:{"Loadout: Anti-Infantry":{certifications:[{skill:a.heavyAssault.grenadeBandolier,level:2},{skill:a.heavyAssault.flakArmor,level:4},{skill:a.heavyAssault.resistShield,level:1},{skill:a.heavyAssault.concussionGrenade,level:1},{skill:a.universal.medicalKit,level:3}],equipment:[b.weapon.decimator]},"Loadout: Anti-Armor":{certifications:[{skill:a.heavyAssault.flakArmor,level:4},{skill:a.heavyAssault.resistShield,level:1},{skill:a.heavyAssault.c4,level:1},{skill:a.heavyAssault.antiVehicleGrenade,level:1}],equipment:[b.weapon.skep,b.weapon.grounder]}}},maxUnit:{meta:{passPercentage:100},classes:{"Loadout: Anti-Infantry":{certifications:[{skill:a.max.kineticArmor,level:5},{skill:a.max.lockdown,level:2}],equipment:[b.max.leftMercy,b.max.rightMercy]},"Loadout: Anti-Armor":{certifications:[{skill:a.max.flakArmor,level:5},{skill:a.max.kineticArmor,level:5},{skill:a.max.lockdown,level:2}],equipment:[b.max.leftPounder,b.max.rightPounder]},"Loadout: Anti-Air":{certifications:[{skill:a.max.flakArmor,level:5},{skill:a.max.lockdown,level:2}],equipment:[b.max.leftBurster,b.max.rightBurster]}}},basicTanks:{meta:{passPercentage:100},classes:{Prowler:{certifications:[{skill:a.prowler.anchoredMode,level:1}],equipment:[b.prowler.walker]},Sunderer:{certifications:[{skill:a.sunderer.vehicleAmmoDispenser,level:1},{skill:a.sunderer.gateShieldDiffuser,level:2}],equipment:[]}}},sunderer:{meta:{passPercentage:100},classes:{Sunderer:{certifications:[{skill:a.sunderer.mineGuard,level:4},{skill:a.sunderer.blockadeArmor,level:4},{skill:a.sunderer.gateShieldDiffuser,level:3},{skill:a.sunderer.naniteProximityRepairSystem,level:6}],equipment:[]}}},prowler:{meta:{passPercentage:100},classes:{Prowler:{certifications:[{skill:a.prowler.anchoredMode,level:4},{skill:a.prowler.mineGuard,level:4}],equipment:[b.prowler.p2120ap,b.prowler.halberd]}}},lightning:{meta:{passPercentage:100},classes:{Lightning:{certifications:[{skill:a.lightning.reinforcedTopArmor,level:1}],equipment:[b.lightning.skyguard]}}},harasser:{meta:{passPercentage:100},classes:{Harasser:{certifications:[{skill:a.harasser.fireSuppressionSystem,level:4},{skill:a.harasser.compositeArmor,level:4},{skill:a.harasser.turbo,level:5}],equipment:[b.harasser.halberd]}}},commander:{meta:{passPercentage:100},classes:{"Squad Leader":{certifications:[{skill:a.squadLeader.commandCommChannel,level:1},{skill:a.squadLeader.requestReinforcements,level:1},{skill:a.squadLeader.rallyPointGreen,level:1},{skill:a.squadLeader.rallyPointOrange,level:1},{skill:a.squadLeader.rallyPointPurple,level:1},{skill:a.squadLeader.rallyPointYellow,level:1},{skill:a.squadLeader.priorityDeployment,level:4}],equipment:[]}}}},f=c("Echo Havoc",null,null,!0),g=c("MAX",f,e.maxUnit),h=c("Heavy Assault",g,e.heavyAssault),i=c("Echo Covert Ops",null,null,!0),j=c("Infiltrator",i,e.infiltrator),k=c("Light Assault",j,e.lightAssault),l=c("Echo Specialist",null,null,!0),m=c("Engineer",l,e.engineer),n=c("Combat Medic",m,e.medic),o=c("Commander",null,e.commander,!0),p=c("Sunderer",[l,i,f],e.sunderer),q=c("Harasser",null,e.harasser),r=c("Lightning",q,e.lightning),s=c("Prowler",r,e.prowler),t=c("Basic Tanks",[p,s],e.basicTanks),u=c("Veteran",[n,k,h,o],e.veteran,!0),v=c("Soldier",[u,t],e.soldier,!0);return d(v),v}function Service(a){function b(){return[SERVICE_PROTO,"://",SERVICE_HOST,"/s:",SERVICE_ID,"/json/get/",SERVICE_BASE,"/",a].join("")}this.get=function(a){var c={"c:lang":"en","c:limit":1e3};return a=$.extend({},c,a),$.ajax({url:b(),data:a,dataType:"jsonp",timeout:1e4})}}function Character(a,b){this.id=a.character_list[0].character_id,this.name=a.character_list[0].name.first,this.rank=a.character_list[0].battle_rank.value,this.outfitRank=a.character_list[0].outfit_member.rank_ordinal,this.outfitRankTitle=a.character_list[0].outfit_member.rank,this.outfitJoinDate=a.character_list[0].outfit_member.member_since_date,this.online="1"===a.character_list[0].online_status,this.lastLogin=a.character_list[0].times.last_login_date,this.getCertLine=function(a){var c=null;return $.each(b.characters_skill_list,function(b,d){return d.skill_id_join_skill&&d.skill_id_join_skill.skill_line_id===a.skill.skillLine.toString()?(c=d.skill_id_join_skill,!1):void 0}),c},this.hasEquipment=function(b){var c=!1;return $.each(a.character_list[0].items,function(a,d){return d.item_id===b.toString()?(c=!0,!1):void 0}),c}}function ItemLoader(a){function b(a){$.isArray(a)?d=d.concat(a):"object"==typeof a?$.each(a,function(a,c){b(c)}):"number"==typeof a&&d.push(a)}var c=new Service("item"),d=[],e=this;e.isPopulated=!1,e.items=[],e.loadItems=function(){var f,g=new $.Deferred;return b(a),f={"c:limit":1e3,"c:lang":"en",item_id:d.join(",")},c.get(f).done(function(a){$.each(a.item_list,function(){e.items[this.item_id]=this.name.en}),e.isPopulated=!0,g.resolve()}),g},e.getItem=function(a){return e.items[a]}}function OutfitLoader(a){var b=new Service(SERVICE_OUTFIT),c=this;c.memberCount=0,c.memberList=[],c.getMembers=function(){var d=new $.Deferred,e={outfit_id:a,"c:resolve":"character(character_id,name.first)","c:show":"character_id","c:sort":"rank_ordinal"};return b.get(e).done(function(a){e.error&&d.reject(e.error),$.each(a.outfit_member_list,function(a,b){c.memberList.push({id:b.character_id,name:b.character.name.first}),c.memberCount++}),d.resolve()}),d}}function MemberLoader(){var a=new Service(SERVICE_CHARACTER),b=new Service(SERVICE_SKILLS);this.get=function(c){var d=new $.Deferred,e={character_id:c.id,"c:resolve":"item_full(name,item_id),outfit_member,online_status","c:show":"name,battle_rank,character_id,outfit_member,online_status,times"},f={character_id:c.id,"c:join":"skill^show:name'skill_id'skill_line_id"};return $.when(a.get(e),b.get(f)).done(function(a,b){(a[0].error||a[0].errorCode||b[0].error||b[0].errorCode)&&d.reject(a[0].error||a[0].errorCode||b[0].error||b[0].errorCode),d.resolve(new Character(a[0],b[0]))}),d}}function MemberReportBuilder(a,b,c){function d(a){var b=$("<a>"),c={"Outfit Rank":a.outfitRankTitle,"Battle Rank":a.rank,"Joined AFX":$.timeago(a.outfitJoinDate),"Last Login":$.timeago(a.lastLogin),Status:a.online?"Online":"Offline"};b.text(a.name),b.attr("href",PLAYERS_URL+a.id),b.attr("target","_blank"),i.append($("<span>").addClass("rank r"+a.outfitRank)),i.append(b),$.each(c,function(a,b){var c=$("<li>"),d=$("<strong>").text(a);c.append(d).append(b),j.append(c)})}function e(a){function b(b){var c={};c={pass:0,total:0},b.tip=$("<div>"),Object.keys(b.classes).length>1&&b.tip.addClass("long"),$.each(b.classes,function(d,e){var f=$("<p>").append("<span>"+d+"</span>");$.each(e.certifications,function(b,d){function e(a){return a.replace(/\d+$/,"").trim()}var g,h=a.getCertLine(d),i=$("<span>");c.total++,h?(g=$.inArray(Number(h.skill_id),d.skill.skills)+1,g<d.level?(i.addClass("notok"),i.text(e(h.name.en)+" "+g+" (need level "+d.level+")")):(i.addClass("ok"),i.text(e(h.name.en)+" "+g),c.pass++)):(i.addClass("notok"),i.text(d.skill.name+" 0 (need level "+d.level+")")),f.append(i)}),$.each(e.equipment,function(b,d){c.total++;var e=a.hasEquipment(d),g=m.getItem(d);e?(f.append("<span>"+g+"</span>"),c.pass++):f.append('<span class="notok">'+g+"</span>")}),b.tip.append(f)}),b.certCount=c,b.pass=g(b)}function c(a,d){a.cert&&b(a.cert),a.child&&$.each(a.child,function(){c(this,d)})}c(l,!0)}function f(a){function b(a){var c=!0;return $.isArray(a)?($.each(a,function(){return c=b(this),c?void 0:!1}),c):(a.parent&&$.each(a.parent,function(){return c=b(this),c?void 0:!1}),c&&a.cert?a.cert.pass:c)}var c=!0,d=!0,e=$("<div>").attr("id",h(a.name)),g=$("<div>");a.rendered||(a.parent&&(c=b(a.parent)),a.cert&&(d=a.cert.pass),c||e.addClass("na"),e.addClass(c&&d?"pass":"fail"),a.isRank&&e.addClass("rank"),g.text(a.name),a.cert&&(g.append($("<p>").text(a.cert.certCount.pass+" out of "+a.cert.certCount.total+" ("+Math.round(a.cert.certCount.pass/a.cert.certCount.total*100)+"%)")),g.data("powertipjq",a.cert.tip)),e.append(g),k.append(e),a.rendered=!0,a.child&&$.each(a.child,function(){f(this)}))}function g(a){var b=Math.round(a.certCount.pass/a.certCount.total*100);return b>=a.meta.passPercentage?!0:!1}function h(a){return a.replace(/\s/g,"-").toLowerCase()}var i=a.find("h2"),j=a.find("#member-details"),k=a.find("#member-tree"),l=new Qualifications(b,c),m=new ItemLoader(c);this.renderReport=function(a){function b(){d(a),e(a),f(l),k.find("div > div").powerTip({smartPlacement:!0}),c.resolve()}var c=new $.Deferred;return m.isPopulated?b():m.loadItems().done(b),c},this.resetReport=function(){k.find("div > div").powerTip("destroy"),i.empty(),j.empty(),k.empty(),l=new Qualifications(b,c)}}function init(a,b){var c,d=$("#character-search"),e=$("#character-name"),f=$("#member-report"),g=new OutfitLoader(OUTFIT_ID),h=new MemberLoader,i=new MemberReportBuilder(f,a,b),j=!1;$(document).ajaxError(error),setComponentDefaults(),$("#legend li").powerTip({placement:"sw-alt"}),e.typeahead(null,{displayKey:"name",source:function(a,b){var c=$.map(g.memberList,function(b){return b.name.toLowerCase().indexOf(a.toLowerCase())>-1?b:void 0});b(c)}}),d.on("submit",function(){var a=e.val(),b=$.grep(g.memberList,function(b){return b.name.toLowerCase()===a.toLowerCase()?!0:void 0});return 1!==b.length||j||c===b[0]||(j=!0,c=b[0],$.when(h.get(c),d.fadeOut(300),f.slideUp(500)).done(function(a){j=!1,i.resetReport(),e.typeahead("close"),e.val(""),d.show(),f.prepend(d),i.renderReport(a).done(function(){f.slideDown(500,function(){$("body").addClass("reportOpen")})})}).fail(function(a){error(a,!0)})),!1}),g.getMembers().done(function(){d.fadeIn(300,function(){e.focus()})})}function setComponentDefaults(){$.fn.powerTip.smartPlacementLists.n=["n","ne","nw","s","se","sw","n"],$.timeago.settings.strings={prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",seconds:"less than a minute",minute:"one minute",minutes:"%d minutes",hour:"one hour",hours:"%d hours",day:"one day",days:"%d days",month:"one month",months:"%d months",year:"one year",years:"%d years",wordSeparator:" ",numbers:[]}}function error(a,b){var c=["<h2>Error</h2>","<p>","There was an error connecting to the SOE API. ","The API servers might have gone down or something broke along the way. ","Please try again later.","</p>"];a&&b===!0&&c.push("<p>",a,"</p>"),$("<div>").attr("id","error").html(c.join("")).appendTo($("body"))}var SERVICE_PROTO="https",SERVICE_HOST="census.soe.com",SERVICE_BASE="ps2:v2",SERVICE_ID="soe",SERVICE_OUTFIT="outfit_member",SERVICE_CHARACTER="character",SERVICE_SKILLS="characters_skill",PLAYERS_URL="https://www.planetside2.com/players/#!/",OUTFIT_ID="37511414368206626";$(function(){$.when($.getJSON("js/definitions/skills.json"),$.getJSON("js/definitions/items.json")).done(function(a,b){init(a[0],b[0])})});